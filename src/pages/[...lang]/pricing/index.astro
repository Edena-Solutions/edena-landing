---
import { translations, languages } from "@/i18n/index.ts";
import Layout from "@/layouts/main.astro";
import Hero from "@/modules/pricing/Hero.astro";
import ProductSchema from "@/components/StructuredData/Product.astro";
import { PricingTabs } from "@/components/PricingTabs";
import { getCollection } from "astro:content";

export function getStaticPaths() {
    return languages.map((lang) => ({
        params: { lang },
        props: { lang },
    }));
}

const { lang } = Astro.props;
const t = translations[lang as keyof typeof translations];
const pricingPlans = await getCollection("pricing");

const offers = pricingPlans
    .filter((plan) => plan.data.price !== "Custom")
    .map((plan) => {
        const priceMatch = plan.data.price.match(/(\d+)/);
        const price = priceMatch ? priceMatch[1] : "0";
        return {
            price: price,
            priceCurrency: "EUR",
            availability: "https://schema.org/InStock",
            url: `https://edena.es/${lang}/pricing`,
        };
    });
---

<Layout
    content={{ title: t.meta.pricingTitle, description: t.meta.pricingDescription }}
    lang={lang}
>
    <ProductSchema
        slot="structured-data"
        name="Edena - Software de Gestión Escolar"
        description={t.meta.pricingDescription}
        offers={offers}
        category="Software de Gestión Escolar"
        lang={lang}
    />
    <section class="grid gap-10 px-4">
        <Hero t={t} />
        <PricingTabs client:load t={t} lang={lang} />
    </section>
</Layout>
